let connected;
let device;
let txCharacteristic;

const butConnect = document.getElementById('butConnect');

function toggle(connected) {
  if (connected) {
    lbl = 'Disconnect';
  } else {
    lbl = 'Connect';
  }
  butConnect.textContent = lbl;
}

function connect() {
  // Filter Bluetooth devices from Adafruit company with manufacturer data 
  // that start with [0x0822].
  navigator.bluetooth.requestDevice({
    filters: [{
      manufacturerData: [{
        companyIdentifier: 0x0822
      }]
    }],
    optionalServices: ['battery_service', '6e400001-b5a3-f393-e0a9-e50e24dcca9e'] // Required to access service later.
  })
  .then(device => {   // Human-readable name of the device.
                      console.log(device.name);
                      connected = device;
                      toggle(connected);
                      // Attempts to connect to remote GATT Server.
                      return device.gatt.connect();})
  .then(server => {
  // Getting Serviceâ€¦
      return server.getPrimaryService('6e400001-b5a3-f393-e0a9-e50e24dcca9e');
      })
  .then(service => {
    // Getting Characteristic
      txCharacteristic = service.getCharacteristic('6e400002-b5a3-f393-e0a9-e50e24dcca9e');
      console.log(txCharacteristic);
      rxCharacteristic = service.getCharacteristic('6e400003-b5a3-f393-e0a9-e50e24dcca9e');
      console.log(rxCharacteristic);
  })
  .then(characteristic => {
    // Getting Value
  txCharacteristicValue = txCharacteristic.readValue;
  rxCharacteristicValue = rxCharacteristic.readValue;
  console.log(txCharacteristicValue);
  console.log(rxCharacteristicValue);
  })
  // .then(value => {
    // Then outputting value
  //   console.log(txCharacteristicValue);
  //   console.log(rxCharacteristicValue);
  // })
  .catch(error => { console.error(error); });
}

function stopconnect() {
  toggle(false);
  connected.gatt.disconnect();
  connected = false;
}

function connectOrDisconnect() {
  if (!connected) {
    connect();
  } else {
    stopconnect();
  }
}

butConnect.addEventListener('click', connectOrDisconnect);