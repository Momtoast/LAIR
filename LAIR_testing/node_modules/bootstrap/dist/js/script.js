let connected;
let device;

const butConnect = document.getElementById('butConnect');

function toggle(connected) {
  if (connected) {
    lbl = 'Disconnect';
  } else {
    lbl = 'Connect';
  }
  butConnect.textContent = lbl;
}

function connect() {
  // Filter Bluetooth devices from Google company with manufacturer data bytes
  // that start with [0x01, 0x02].
  navigator.bluetooth.requestDevice({
    filters: [{
      manufacturerData: [{
        companyIdentifier: 0x0822,
      }]
    }],
    optionalServices: ['battery_service'] // Required to access service later.
  })
  .then(device => {   // Human-readable name of the device.
                      console.log(device.name);
                      connected = device;
                      toggle(connected);
                      // Attempts to connect to remote GATT Server.
                      return device.gatt.connect();})
  .catch(error => { console.error(error); });
}

function stopconnect() {
  toggle(false);
  connected.gatt.disconnect();
}

function connectOrDisconnect() {
  if (!connected) {
    connect();
  } else {
    stopconnect();
  }
}

butConnect.addEventListener('click', connectOrDisconnect);